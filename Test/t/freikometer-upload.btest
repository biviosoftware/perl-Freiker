# Copyright (c) 2006-2007 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('Freiker');
home_page();
basic_authorization('fm_freikometer');
do_test_backdoor(Test => '-realm fm_freikometer reset_freikometer_folders');
my($epc) = test_use('Freiker::Test')->EPC;
my($date) = test_use('Type.DateTime')->local_now_as_file_name;
basic_authorization('fm_freikometer');
send_request(PUT => "/fm/$date.csv", undef, <<"EOF");
EPC,DateTime
$epc,$date
EOF
test_equals(qr{.*Download/test\.sh$}, get_uri());
test_equals("date\n", get_content());
home_page();
do_logout();
login_as('adm');
verify_table(Freikometer => [
    ['Freikometer', 'Last Upload'],
    [qr{^fm_freikometer$}, qr{\Q@{[test_use('Type.Date')->now_as_string]}\E}],
]);
