# Copyright (c) 2007 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('Freiker');
home_page();
do_test_backdoor(Test => 'reset_freikers');
login_as('parent');
follow_link('child6');
go_back();
follow_link_in_table(qw(freiker freiker child6 action missing));
go_back();
follow_link_in_table(qw(freiker freiker child6 action helmet));
go_back();
follow_link('register.*child');
submit_form({
    first => 'Bobby',
    freiker => '1237',
    school => 'bunit Elementary',
    birth => '1999',
    radio => 'Male',
});
follow_link_in_table(qw(freiker freiker bobby action helmet));
sleep(1);
submit_form({
    freiker => '1238',
    school => 'bunit Elementary',
});
verify_text('Bobby (1238, 1237)');
follow_link('missing');
my($d) = test_use('Type.Date');
submit_form({
    date => $d->now_as_string,
});
verify_table(Date => [
    ['Date'],
    map([$d->to_string($d->add_days($d->now, 0))],
	0, -3, -4,),
]);
follow_link('helmet');
test_deviance('already assigned');
submit_form({
    freiker => '1238',
    school => 'bunit Elementary',
});
test_conformance();
do_logout();
login_as('1237');
follow_link('Bobby');
verify_text('Bobby (1238, 1237)');
do_logout();
test_deviance(qr{not.*registered.*please.*click}i);
login_as('1239');
